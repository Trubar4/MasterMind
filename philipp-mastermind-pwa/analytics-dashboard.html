<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastermind Analytics Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    .header h1 {
      margin: 0;
      color: #333;
    }
    .date-range {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
      margin-bottom: 20px;
    }
    .card-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }
    .stat-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    .stat-card {
      background: #f9f9f9;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #6200EE;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table th, table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    table th {
      background-color: #f9f9f9;
      font-weight: bold;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    button {
      background-color: #6200EE;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #5000c9;
    }
    .filter {
      background-color: white;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      margin-left: 10px;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #6200EE;
      border-radius: 50%;
      animation: spin 2s linear infinite;
    }
    .status-message {
      padding: 10px;
      background-color: #e8f5e9;
      color: #2e7d32;
      border-radius: 4px;
      margin-bottom: 20px;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Philipp's Mastermind Analytics</h1>
    </div>
    
    <div id="status-message" class="status-message"></div>
    
    <div class="date-range">
      <label for="start-date">From:</label>
      <input type="date" id="start-date">
      <label for="end-date">To:</label>
      <input type="date" id="end-date">
      <button id="apply-date">Apply</button>
    </div>

    <div class="controls">
      <div>
        <button id="refresh-data">Refresh Data</button>
        <button id="export-data">Export CSV</button>
      </div>
      <div>
        <select id="filter-mode" class="filter">
          <option value="all">All Game Modes</option>
          <option value="both">2 Player</option>
          <option value="codemakerMode">Computer as Breaker</option>
          <option value="codebreakerMode">Computer as Maker</option>
        </select>
        <select id="filter-code-length" class="filter">
          <option value="all">All Code Lengths</option>
          <option value="4">4 Circles</option>
          <option value="5">5 Circles</option>
        </select>
      </div>
    </div>

    <div class="dashboard">
      <!-- Overview Stats -->
      <div class="card">
        <div class="card-header">Overview</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="total-games">1,250</div>
            <div class="stat-label">Games Played</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="total-users">450</div>
            <div class="stat-label">Unique Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-session">5m 30s</div>
            <div class="stat-label">Avg. Session</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="completion-rate">85.7%</div>
            <div class="stat-label">Completion Rate</div>
          </div>
        </div>
      </div>

      <!-- Game Performance -->
      <div class="card">
        <div class="card-header">Game Performance</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="win-rate">62.5%</div>
            <div class="stat-label">Win Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-attempts">5.8</div>
            <div class="stat-label">Avg. Attempts</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="give-up-rate">18.3%</div>
            <div class="stat-label">Give Up Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-time">3m 45s</div>
            <div class="stat-label">Avg. Game Time</div>
          </div>
        </div>
      </div>

      <!-- Games Over Time Chart -->
      <div class="card">
        <div class="card-header">Games Played Over Time</div>
        <div class="chart-container">
          <canvas id="games-over-time"></canvas>
        </div>
      </div>

      <!-- Game Mode Preference -->
      <div class="card">
        <div class="card-header">Game Mode Preference</div>
        <div class="chart-container">
          <canvas id="mode-preference"></canvas>
        </div>
      </div>

      <!-- Language Distribution -->
      <div class="card">
        <div class="card-header">Language Distribution</div>
        <div class="chart-container">
          <canvas id="language-distribution"></canvas>
        </div>
      </div>

      <!-- Code Length Preference -->
      <div class="card">
        <div class="card-header">Code Length Preference</div>
        <div class="chart-container">
          <canvas id="length-preference"></canvas>
        </div>
      </div>

      <!-- Color Usage -->
      <div class="card">
        <div class="card-header">Color Usage</div>
        <div class="chart-container">
          <canvas id="color-usage"></canvas>
        </div>
      </div>

      <!-- Win Rate by Attempts -->
      <div class="card">
        <div class="card-header">Win Rate by Attempts</div>
        <div class="chart-container">
          <canvas id="win-by-attempts"></canvas>
        </div>
      </div>

      <!-- Recent Game Sessions -->
      <div class="card">
        <div class="card-header">Recent Game Sessions</div>
        <table id="recent-games">
          <thead>
            <tr>
              <th>Date</th>
              <th>Mode</th>
              <th>Result</th>
              <th>Attempts</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data will be inserted here dynamically -->
          </tbody>
        </table>
      </div>

      <!-- Device Distribution -->
      <div class="card">
        <div class="card-header">Device Distribution</div>
        <div class="chart-container">
          <canvas id="device-distribution"></canvas>
        </div>
      </div>
      
      <!-- Error Rates -->
      <div class="card">
        <div class="card-header">Error Rates</div>
        <div class="chart-container">
          <canvas id="error-rates"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // Store chart instances for later reference
    const chartInstances = {};
    
    // Show status message
    function showStatus(message) {
      const statusElement = document.getElementById('status-message');
      statusElement.textContent = message;
      statusElement.style.display = 'block';
      setTimeout(() => {
        statusElement.style.display = 'none';
      }, 3000);
    }
    
    // Show loading overlay
    function showLoading() {
      document.getElementById('loading-overlay').style.display = 'flex';
    }
    
    // Hide loading overlay
    function hideLoading() {
      document.getElementById('loading-overlay').style.display = 'none';
    }
    
    // Initialize charts with demo data
    function initializeCharts() {
      // Games Over Time Chart
      const gamesOverTimeCtx = document.getElementById('games-over-time').getContext('2d');
      chartInstances.gamesOverTime = new Chart(gamesOverTimeCtx, {
        type: 'line',
        data: {
          labels: ['04/01', '04/02', '04/03', '04/04', '04/05', '04/06', '04/07', '04/08', '04/09', '04/10', 
                  '04/11', '04/12', '04/13', '04/14', '04/15', '04/16', '04/17', '04/18', '04/19', '04/20'],
          datasets: [{
            label: 'Games',
            data: [25, 32, 28, 35, 40, 38, 42, 45, 50, 48, 52, 55, 58, 60, 62, 65, 68, 72, 75, 78],
            borderColor: '#6200EE',
            backgroundColor: 'rgba(98, 0, 238, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
      
      // Mode Preference Chart
      const modePreferenceCtx = document.getElementById('mode-preference').getContext('2d');
      chartInstances.modePreference = new Chart(modePreferenceCtx, {
        type: 'doughnut',
        data: {
          labels: ['2 Player', 'Computer as Breaker', 'Computer as Maker'],
          datasets: [{
            data: [45, 30, 25],
            backgroundColor: ['#4CAF50', '#2196F3', '#FF9800']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
      
      // Language Distribution Chart
      const languageCtx = document.getElementById('language-distribution').getContext('2d');
      chartInstances.languageDistribution = new Chart(languageCtx, {
        type: 'pie',
        data: {
          labels: ['English', 'German'],
          datasets: [{
            data: [70, 30],
            backgroundColor: ['#3F51B5', '#E91E63']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
      
      // Code Length Preference Chart
      const lengthCtx = document.getElementById('length-preference').getContext('2d');
      chartInstances.lengthPreference = new Chart(lengthCtx, {
        type: 'bar',
        data: {
          labels: ['4 Circles', '5 Circles'],
          datasets: [{
            label: 'Games',
            data: [65, 35],
            backgroundColor: '#9C27B0'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
      
      // Color Usage Chart
      const colorCtx = document.getElementById('color-usage').getContext('2d');
      chartInstances.colorUsage = new Chart(colorCtx, {
        type: 'bar',
        data: {
          labels: ['Red', 'Yellow', 'Orange', 'Pink', 'Blue', 'Green', 'Gray', 'Black'],
          datasets: [{
            label: 'Usage Count',
            data: [120, 95, 85, 75, 110, 90, 60, 70],
            backgroundColor: [
              '#FF0000', '#FFFF00', '#FFC000', '#F36DED', 
              '#0070C0', '#00B050', '#A6A6A6', '#000000'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
      
      // Win Rate by Attempts Chart
      const winByAttemptsCtx = document.getElementById('win-by-attempts').getContext('2d');
      chartInstances.winByAttempts = new Chart(winByAttemptsCtx, {
        type: 'line',
        data: {
          labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
          datasets: [{
            label: 'Win Rate',
            data: [90, 75, 65, 50, 40, 30, 25, 20, 15, 10],
            borderColor: '#00BCD4',
            backgroundColor: 'rgba(0, 188, 212, 0.2)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: function(value) {
                  return value + '%';
                }
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.parsed.y + '%';
                }
              }
            }
          }
        }
      });
      
      // Device Distribution Chart
      const deviceCtx = document.getElementById('device-distribution').getContext('2d');
      chartInstances.deviceDistribution = new Chart(deviceCtx, {
        type: 'pie',
        data: {
          labels: ['Desktop', 'Mobile', 'Tablet'],
          datasets: [{
            data: [55, 35, 10],
            backgroundColor: ['#607D8B', '#FF5722', '#795548']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
      
      // Error Rates Chart
      const errorCtx = document.getElementById('error-rates').getContext('2d');
      chartInstances.errorRates = new Chart(errorCtx, {
        type: 'bar',
        data: {
          labels: ['Game Logic', 'Network', 'Input', 'Rendering', 'Other'],
          datasets: [{
            label: 'Error Count',
            data: [12, 8, 5, 3, 4],
            backgroundColor: '#F44336'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0
              }
            }
          }
        }
      });
    }
    
    // Load recent games data
    function loadRecentGames() {
      const sampleGames = [
        { date: '04/20/2025', mode: '2 Player', result: 'Win', attempts: 5, duration: '2m 45s' },
        { date: '04/19/2025', mode: 'Computer as Maker', result: 'Win', attempts: 7, duration: '4m 12s' },
        { date: '04/19/2025', mode: '2 Player', result: 'Loss', attempts: 10, duration: '5m 30s' },
        { date: '04/18/2025', mode: 'Computer as Breaker', result: 'Win', attempts: 4, duration: '2m 15s' },
        { date: '04/17/2025', mode: 'Computer as Maker', result: 'Abandoned', attempts: 3, duration: '1m 45s' },
        { date: '04/16/2025', mode: '2 Player', result: 'Win', attempts: 6, duration: '3m 10s' },
        { date: '04/15/2025', mode: 'Computer as Breaker', result: 'Loss', attempts: 10, duration: '6m 05s' },
        { date: '04/15/2025', mode: 'Computer as Maker', result: 'Win', attempts: 5, duration: '3m 30s' },
        { date: '04/14/2025', mode: '2 Player', result: 'Win', attempts: 3, duration: '1m 50s' },
        { date: '04/13/2025', mode: 'Computer as Breaker', result: 'Win', attempts: 8, duration: '4m 40s' }
      ];
      
      const tableBody = document.querySelector('#recent-games tbody');
      tableBody.innerHTML = ''; // Clear existing rows
      
      for (const game of sampleGames) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${game.date}</td>
          <td>${game.mode}</td>
          <td>${game.result}</td>
          <td>${game.attempts}</td>
          <td>${game.duration}</td>
        `;
        
        tableBody.appendChild(tr);
      }
    }
    
    // Initialize date inputs with default values (last 30 days)
    function initializeDateRange() {
      const today = new Date();
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(today.getDate() - 30);
      
      const formatDate = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };
      
      document.getElementById('start-date').value = formatDate(thirtyDaysAgo);
      document.getElementById('end-date').value = formatDate(today);
    }
    
    // Simulate data refresh
    function refreshData() {
      showLoading();
      
      // Simulate delay for loading data
      setTimeout(() => {
        // Update random statistics to simulate new data
        const randomPercentage = () => (Math.random() * 30 + 60).toFixed(1) + '%';
        const randomNumber = (min, max) => (Math.random() * (max - min) + min).toFixed(1);
        
        document.getElementById('win-rate').textContent = randomPercentage();
        document.getElementById('give-up-rate').textContent = (Math.random() * 20 + 10).toFixed(1) + '%';
        document.getElementById('avg-attempts').textContent = randomNumber(4, 7);
        
        // Update games over time chart with random values
        const newData = chartInstances.gamesOverTime.data.datasets[0].data.map(() => 
          Math.floor(Math.random() * 50) + 20
        );
        chartInstances.gamesOverTime.data.datasets[0].data = newData;
        chartInstances.gamesOverTime.update();
        
        hideLoading();
        showStatus('Data refreshed successfully');
      }, 1000);
    }
    
    // Export data to CSV
    function exportDataToCSV() {
      showLoading();
      
      // Create CSV content
      let csvContent = 'data:text/csv;charset=utf-8,';
      
      // Add overview section
      csvContent += 'OVERVIEW\r\n';
      csvContent += 'Metric,Value\r\n';
      csvContent += 'Total Games,' + document.getElementById('total-games').textContent + '\r\n';
      csvContent += 'Unique Users,' + document.getElementById('total-users').textContent + '\r\n';
      csvContent += 'Average Session,' + document.getElementById('avg-session').textContent + '\r\n';
      csvContent += 'Completion Rate,' + document.getElementById('completion-rate').textContent + '\r\n';
      csvContent += '\r\n';
      
      // Add performance section
      csvContent += 'PERFORMANCE\r\n';
      csvContent += 'Metric,Value\r\n';
      csvContent += 'Win Rate,' + document.getElementById('win-rate').textContent + '\r\n';
      csvContent += 'Average Attempts,' + document.getElementById('avg-attempts').textContent + '\r\n';
      csvContent += 'Give Up Rate,' + document.getElementById('give-up-rate').textContent + '\r\n';
      csvContent += 'Average Game Time,' + document.getElementById('avg-time').textContent + '\r\n';
      csvContent += '\r\n';
      
      // Add games over time
      csvContent += 'GAMES OVER TIME\r\n';
      csvContent += 'Date,Games\r\n';
      chartInstances.gamesOverTime.data.labels.forEach((label, i) => {
        csvContent += `${label},${chartInstances.gamesOverTime.data.datasets[0].data[i]}\r\n`;
      });
      csvContent += '\r\n';
      
      // Add mode preference
      csvContent += 'MODE PREFERENCE\r\n';
      csvContent += 'Mode,Count\r\n';
      chartInstances.modePreference.data.labels.forEach((label, i) => {
        csvContent += `${label},${chartInstances.modePreference.data.datasets[0].data[i]}\r\n`;
      });
      csvContent += '\r\n';
      
      // Create a download link and trigger click
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'mastermind_analytics.csv');
      document.body.appendChild(link);
      
      link.click();
      document.body.removeChild(link);
      
      hideLoading();
      showStatus('Data exported successfully');
    }
    
    // Initialize the application
    function init() {
      initializeDateRange();
      initializeCharts();
      loadRecentGames();
      
      // Add event listeners
      document.getElementById('refresh-data').addEventListener('click', refreshData);
      document.getElementById('export-data').addEventListener('click', exportDataToCSV);
      document.getElementById('apply-date').addEventListener('click', function() {
        showStatus('Date range applied');
        refreshData();
      });
      
      document.getElementById('filter-mode').addEventListener('change', function() {
        showStatus('Filter applied: ' + this.options[this.selectedIndex].text);
        refreshData();
      });
      
      document.getElementById('filter-code-length').addEventListener('change', function() {
        showStatus('Filter applied: ' + this.options[this.selectedIndex].text);
        refreshData();
      });
    }
    
    // Start the application when the page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>