<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastermind Analytics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    .header h1 {
      margin: 0;
      color: #333;
    }
    .date-range {
      display: flex;
      gap: 10px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
    }
    .card-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }
    .stat-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    .stat-card {
      background: #f9f9f9;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #6200EE;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table th, table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    table th {
      background-color: #f9f9f9;
      font-weight: bold;
    }
    .color-sample {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 5px;
      vertical-align: middle;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    button {
      background-color: #6200EE;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #5000c9;
    }
    .filter {
      background-color: white;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Philipp's Mastermind Analytics</h1>
      <div class="date-range">
        <input type="date" id="start-date">
        <input type="date" id="end-date">
        <button id="apply-date">Apply</button>
      </div>
    </div>

    <div class="controls">
      <div>
        <button id="refresh-data">Refresh Data</button>
        <button id="export-data">Export CSV</button>
      </div>
      <div>
        <select id="filter-mode" class="filter">
          <option value="all">All Game Modes</option>
          <option value="both">2 Player</option>
          <option value="codemakerMode">Computer as Breaker</option>
          <option value="codebreakerMode">Computer as Maker</option>
        </select>
        <select id="filter-code-length" class="filter">
          <option value="all">All Code Lengths</option>
          <option value="4">4 Circles</option>
          <option value="5">5 Circles</option>
        </select>
      </div>
    </div>

    <div class="dashboard">
      <!-- Overview Stats -->
      <div class="card">
        <div class="card-header">Overview</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="total-games">0</div>
            <div class="stat-label">Games Played</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="total-users">0</div>
            <div class="stat-label">Unique Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-session">0m</div>
            <div class="stat-label">Avg. Session</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="completion-rate">0%</div>
            <div class="stat-label">Completion Rate</div>
          </div>
        </div>
      </div>

      <!-- Game Performance -->
      <div class="card">
        <div class="card-header">Game Performance</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="win-rate">0%</div>
            <div class="stat-label">Win Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-attempts">0</div>
            <div class="stat-label">Avg. Attempts</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="give-up-rate">0%</div>
            <div class="stat-label">Give Up Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-time">0s</div>
            <div class="stat-label">Avg. Game Time</div>
          </div>
        </div>
      </div>

      <!-- Games Over Time Chart -->
      <div class="card">
        <div class="card-header">Games Played Over Time</div>
        <div class="chart-container">
          <canvas id="games-over-time"></canvas>
        </div>
      </div>

      <!-- Game Mode Preference -->
      <div class="card">
        <div class="card-header">Game Mode Preference</div>
        <div class="chart-container">
          <canvas id="mode-preference"></canvas>
        </div>
      </div>

      <!-- Language Distribution -->
      <div class="card">
        <div class="card-header">Language Distribution</div>
        <div class="chart-container">
          <canvas id="language-distribution"></canvas>
        </div>
      </div>

      <!-- Code Length Preference -->
      <div class="card">
        <div class="card-header">Code Length Preference</div>
        <div class="chart-container">
          <canvas id="length-preference"></canvas>
        </div>
      </div>

      <!-- Color Usage -->
      <div class="card">
        <div class="card-header">Color Usage</div>
        <div class="chart-container">
          <canvas id="color-usage"></canvas>
        </div>
      </div>

      <!-- Win Rate by Attempts -->
      <div class="card">
        <div class="card-header">Win Rate by Attempts</div>
        <div class="chart-container">
          <canvas id="win-by-attempts"></canvas>
        </div>
      </div>

      <!-- Recent Game Sessions -->
      <div class="card">
        <div class="card-header">Recent Game Sessions</div>
        <table id="recent-games">
          <thead>
            <tr>
              <th>Date</th>
              <th>Mode</th>
              <th>Result</th>
              <th>Attempts</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data will be inserted here dynamically -->
          </tbody>
        </table>
      </div>

      <!-- Device Distribution -->
      <div class="card">
        <div class="card-header">Device Distribution</div>
        <div class="chart-container">
          <canvas id="device-distribution"></canvas>
        </div>
      </div>
      
      <!-- Error Rates -->
      <div class="card">
        <div class="card-header">Error Rates</div>
        <div class="chart-container">
          <canvas id="error-rates"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mock data for demonstration purposes
    // In a real implementation, you would fetch this data from your analytics backend
    const mockData = {
      overview: {
        totalGames: 546,
        uniqueUsers: 203,
        avgSessionMinutes: 12,
        completionRate: 78
      },
      performance: {
        winRate: 65,
        avgAttempts: 6.2,
        giveUpRate: 15,
        avgGameTimeSeconds: 145
      },
      gamesOverTime: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        data: [42, 58, 69, 85, 125, 167]
      },
      modePreference: {
        labels: ['2 Player', 'Computer as Breaker', 'Computer as Maker'],
        data: [45, 30, 25]
      },
      languageDistribution: {
        labels: ['English', 'German'],
        data: [35, 65]
      },
      lengthPreference: {
        labels: ['4 Circles', '5 Circles'],
        data: [78, 22]
      },
      colorUsage: {
        labels: ['Red', 'Yellow', 'Orange', 'Pink', 'Blue', 'Green', 'Gray', 'Black'],
        data: [22, 15, 13, 12, 11, 10, 9, 8],
        backgroundColor: [
          '#FF0000', '#FFFF00', '#FFC000', '#F36DED', 
          '#0070C0', '#00B050', '#A6A6A6', '#000000'
        ]
      },
      winByAttempts: {
        labels: ['1-3', '4-6', '7-8', '9-10'],
        data: [12, 43, 35, 10]
      },
      deviceDistribution: {
        labels: ['Mobile', 'Tablet', 'Desktop'],
        data: [55, 15, 30]
      },
      errorRates: {
        labels: ['JavaScript', 'Network', 'Service Worker', 'Other'],
        data: [3, 2, 1, 1]
      },
      recentGames: [
        { date: '2025-04-23', mode: '2 Player', result: 'Win', attempts: 5, duration: '2m 15s' },
        { date: '2025-04-23', mode: 'Computer as Maker', result: 'Loss', attempts: 10, duration: '3m 42s' },
        { date: '2025-04-22', mode: '2 Player', result: 'Win', attempts: 7, duration: '3m 05s' },
        { date: '2025-04-22', mode: 'Computer as Breaker', result: 'Win', attempts: 8, duration: '1m 52s' },
        { date: '2025-04-21', mode: 'Computer as Maker', result: 'Abandoned', attempts: 3, duration: '0m 48s' }
      ]
    };

    // Initialize the dashboard with mock data
    document.addEventListener('DOMContentLoaded', function() {
      // Set today's date as end date and 30 days ago as start date
      const endDate = new Date();
      const startDate = new Date();
      startDate.setDate(startDate.getDate() - 30);
      
      document.getElementById('end-date').valueAsDate = endDate;
      document.getElementById('start-date').valueAsDate = startDate;
      
      // Populate overview stats
      document.getElementById('total-games').textContent = mockData.overview.totalGames;
      document.getElementById('total-users').textContent = mockData.overview.uniqueUsers;
      document.getElementById('avg-session').textContent = mockData.overview.avgSessionMinutes + 'm';
      document.getElementById('completion-rate').textContent = mockData.overview.completionRate + '%';
      
      // Populate performance stats
      document.getElementById('win-rate').textContent = mockData.performance.winRate + '%';
      document.getElementById('avg-attempts').textContent = mockData.performance.avgAttempts;
      document.getElementById('give-up-rate').textContent = mockData.performance.giveUpRate + '%';
      document.getElementById('avg-time').textContent = mockData.performance.avgGameTimeSeconds + 's';
      
      // Create charts
      createLineChart('games-over-time', 'Games Played', mockData.gamesOverTime.labels, mockData.gamesOverTime.data);
      createPieChart('mode-preference', mockData.modePreference.labels, mockData.modePreference.data);
      createPieChart('language-distribution', mockData.languageDistribution.labels, mockData.languageDistribution.data);
      createPieChart('length-preference', mockData.lengthPreference.labels, mockData.lengthPreference.data);
      createBarChart('color-usage', 'Color Usage', mockData.colorUsage.labels, mockData.colorUsage.data, mockData.colorUsage.backgroundColor);
      createBarChart('win-by-attempts', 'Wins', mockData.winByAttempts.labels, mockData.winByAttempts.data);
      createPieChart('device-distribution', mockData.deviceDistribution.labels, mockData.deviceDistribution.data);
      createBarChart('error-rates', 'Error Count', mockData.errorRates.labels, mockData.errorRates.data);
      
      // Populate recent games table
      const tableBody = document.querySelector('#recent-games tbody');
      mockData.recentGames.forEach(game => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${game.date}</td>
          <td>${game.mode}</td>
          <td>${game.result}</td>
          <td>${game.attempts}</td>
          <td>${game.duration}</td>
        `;
        tableBody.appendChild(row);
      });
      
      // Add event listeners
      document.getElementById('refresh-data').addEventListener('click', refreshData);
      document.getElementById('export-data').addEventListener('click', exportData);
      document.getElementById('apply-date').addEventListener('click', applyDateRange);
      document.getElementById('filter-mode').addEventListener('change', applyFilters);
      document.getElementById('filter-code-length').addEventListener('change', applyFilters);
    });

    function createLineChart(canvasId, label, labels, data) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: data,
            borderColor: '#6200EE',
            backgroundColor: 'rgba(98, 0, 238, 0.1)',
            borderWidth: 2,
            tension: 0.1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function createPieChart(canvasId, labels, data) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: [
              '#6200EE',
              '#03DAC5',
              '#B00020',
              '#FFDE03',
              '#FF7597'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
    }

    function createBarChart(canvasId, label, labels, data, backgroundColor) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: data,
            backgroundColor: backgroundColor || '#6200EE',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function refreshData() {
      // In a real implementation, this would fetch fresh data from your backend
      alert('In a real implementation, this would refresh data from your analytics backend.');
    }

    function exportData() {
      // In a real implementation, this would generate and download a CSV file
      alert('In a real implementation, this would generate and download a CSV file of your analytics data.');
    }

    function applyDateRange() {
      const startDate = document.getElementById('start-date').value;
      const endDate = document.getElementById('end-date').value;
      
      if (!startDate || !endDate) {
        alert('Please select both start and end dates.');
        return;
      }
      
      // In a real implementation, this would filter data based on the date range
      alert(`Date range applied: ${startDate} to ${endDate}`);
    }

    function applyFilters() {
      const modeFilter = document.getElementById('filter-mode').value;
      const codeLengthFilter = document.getElementById('filter-code-length').value;
      
      // In a real implementation, this would filter the displayed data
      alert(`Filters applied: Mode=${modeFilter}, Code Length=${codeLengthFilter}`);
    }
  </script>