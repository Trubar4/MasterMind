<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mastermind Analytics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load the Google Analytics Embed API library -->
  <script>
  (function(w,d,s,g,js,fjs){
    g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(cb){this.q.push(cb)}};
    js=d.createElement(s);fjs=d.getElementsByTagName(s)[0];
    js.src='https://apis.google.com/js/platform.js';
    fjs.parentNode.insertBefore(js,fjs);js.onload=function(){g.load('analytics')};
  }(window,document,'script'));
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    .header h1 {
      margin: 0;
      color: #333;
    }
    .date-range {
      display: flex;
      gap: 10px;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
      gap: 20px;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
    }
    .card-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }
    .stat-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    .stat-card {
      background: #f9f9f9;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #6200EE;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table th, table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    table th {
      background-color: #f9f9f9;
      font-weight: bold;
    }
    .color-sample {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 5px;
      vertical-align: middle;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    button {
      background-color: #6200EE;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #5000c9;
    }
    .filter {
      background-color: white;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div id="auth-button" style="margin-bottom: 20px;"></div>
  <div class="container">
    <div class="header">
      <h1>Philipp's Mastermind Analytics</h1>
      <div class="date-range">
        <input type="date" id="start-date">
        <input type="date" id="end-date">
        <button id="apply-date">Apply</button>
      </div>
    </div>

    <div class="controls">
      <div>
        <button id="refresh-data">Refresh Data</button>
        <button id="export-data">Export CSV</button>
      </div>
      <div>
        <select id="filter-mode" class="filter">
          <option value="all">All Game Modes</option>
          <option value="both">2 Player</option>
          <option value="codemakerMode">Computer as Breaker</option>
          <option value="codebreakerMode">Computer as Maker</option>
        </select>
        <select id="filter-code-length" class="filter">
          <option value="all">All Code Lengths</option>
          <option value="4">4 Circles</option>
          <option value="5">5 Circles</option>
        </select>
      </div>
    </div>

    <div class="dashboard">
      <!-- Overview Stats -->
      <div class="card">
        <div class="card-header">Overview</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="total-games">0</div>
            <div class="stat-label">Games Played</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="total-users">0</div>
            <div class="stat-label">Unique Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-session">0m</div>
            <div class="stat-label">Avg. Session</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="completion-rate">0%</div>
            <div class="stat-label">Completion Rate</div>
          </div>
        </div>
      </div>

      <!-- Game Performance -->
      <div class="card">
        <div class="card-header">Game Performance</div>
        <div class="stat-container">
          <div class="stat-card">
            <div class="stat-value" id="win-rate">0%</div>
            <div class="stat-label">Win Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-attempts">0</div>
            <div class="stat-label">Avg. Attempts</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="give-up-rate">0%</div>
            <div class="stat-label">Give Up Rate</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="avg-time">0s</div>
            <div class="stat-label">Avg. Game Time</div>
          </div>
        </div>
      </div>

      <!-- Games Over Time Chart -->
      <div class="card">
        <div class="card-header">Games Played Over Time</div>
        <div class="chart-container">
          <canvas id="games-over-time"></canvas>
        </div>
      </div>

      <!-- Game Mode Preference -->
      <div class="card">
        <div class="card-header">Game Mode Preference</div>
        <div class="chart-container">
          <canvas id="mode-preference"></canvas>
        </div>
      </div>

      <!-- Language Distribution -->
      <div class="card">
        <div class="card-header">Language Distribution</div>
        <div class="chart-container">
          <canvas id="language-distribution"></canvas>
        </div>
      </div>

      <!-- Code Length Preference -->
      <div class="card">
        <div class="card-header">Code Length Preference</div>
        <div class="chart-container">
          <canvas id="length-preference"></canvas>
        </div>
      </div>

      <!-- Color Usage -->
      <div class="card">
        <div class="card-header">Color Usage</div>
        <div class="chart-container">
          <canvas id="color-usage"></canvas>
        </div>
      </div>

      <!-- Win Rate by Attempts -->
      <div class="card">
        <div class="card-header">Win Rate by Attempts</div>
        <div class="chart-container">
          <canvas id="win-by-attempts"></canvas>
        </div>
      </div>

      <!-- Recent Game Sessions -->
      <div class="card">
        <div class="card-header">Recent Game Sessions</div>
        <table id="recent-games">
          <thead>
            <tr>
              <th>Date</th>
              <th>Mode</th>
              <th>Result</th>
              <th>Attempts</th>
              <th>Duration</th>
            </tr>
          </thead>
          <tbody>
            <!-- Data will be inserted here dynamically -->
          </tbody>
        </table>
      </div>

      <!-- Device Distribution -->
      <div class="card">
        <div class="card-header">Device Distribution</div>
        <div class="chart-container">
          <canvas id="device-distribution"></canvas>
        </div>
      </div>
      
      <!-- Error Rates -->
      <div class="card">
        <div class="card-header">Error Rates</div>
        <div class="chart-container">
          <canvas id="error-rates"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Wait for the Google Analytics Embed API to load
    gapi.analytics.ready(function() {
      
    // Authorize the user with an access token obtained server-side.
	  gapi.analytics.auth.authorize({
		'serverAuth': {
		  'access_token': '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'
		}
	  });
  // OR use OAuth 2.0 client ID for client-side authentication
	  gapi.analytics.auth.authorize({
		clientid: '82857070912-7n6f5ekb5161f02mupl5d1d7b5j3656f.apps.googleusercontent.com',
		container: 'auth-button'
	  });
	  
      // Add an auth button that lets users authenticate with their Google account
      const authButton = new gapi.analytics.auth.AuthButton({
        container: 'auth-button'
      });
      
      // Configure authorization
      authButton.once('success', function() {
        // On successful authentication, fetch data and display the dashboard
        fetchAnalyticsData();
      });
      
      function fetchAnalyticsData() {
        // Get date range values
        const startDate = document.getElementById('start-date').value || '30daysAgo';
        const endDate = document.getElementById('end-date').value || 'today';
        
        // Create a query to fetch total games played
        const totalGamesQuery = new gapi.analytics.report.Data({
          query: {
			'ids': 'ga:10626080660',
            'start-date': startDate,
            'end-date': endDate,
            'metrics': 'ga:totalEvents',
            'dimensions': 'ga:eventCategory,ga:eventAction',
            'filters': 'ga:eventCategory==game,ga:eventAction==start'
          }
        });
        
        // Execute the query and update the dashboard
        totalGamesQuery.execute(function(response) {
          if (response.error) {
            console.error('Error fetching total games:', response.error.message);
            return;
          }
          
          // Extract total games played from the response
          let totalGames = 0;
          if (response.rows && response.rows.length > 0) {
            totalGames = parseInt(response.rows[0][2]);
          }
          
          // Update the UI
          document.getElementById('total-games').textContent = totalGames;
          
          // Continue with other queries for additional metrics...
          // You would create similar queries for each metric/chart
        });
      }
      
      // Add event listeners
      document.getElementById('apply-date').addEventListener('click', fetchAnalyticsData);
    });
  </script>
</body>
</html>